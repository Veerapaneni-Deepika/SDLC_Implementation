        -:    0:Source:src/addDate.c
        -:    1:#include "fun.h"
        -:    2:
        1:    3:int offsetDays(int d, int m, int y)
        -:    4:{
        1:    5:    int offset = d;
        -:    6:  
        1:    7:    switch (m - 1)
        1:    7-block  0
        -:    8:    {
    #####:    9:    case 11:
    #####:   10:        offset += 30;
    %%%%%:   10-block  0
    #####:   11:    case 10:
    #####:   12:        offset += 31;
    %%%%%:   12-block  0
    #####:   13:    case 9:
    #####:   14:        offset += 30;
    %%%%%:   14-block  0
    #####:   15:    case 8:
    #####:   16:        offset += 31;
    %%%%%:   16-block  0
    #####:   17:    case 7:
    #####:   18:        offset += 31;
    %%%%%:   18-block  0
    #####:   19:    case 6:
    #####:   20:        offset += 30;
    %%%%%:   20-block  0
    #####:   21:    case 5:
    #####:   22:        offset += 31;
    %%%%%:   22-block  0
    #####:   23:    case 4:
    #####:   24:        offset += 30;
    %%%%%:   24-block  0
    #####:   25:    case 3:
    #####:   26:        offset += 31;
    %%%%%:   26-block  0
    #####:   27:    case 2:
    #####:   28:        offset += 28;
    %%%%%:   28-block  0
    #####:   29:    case 1:
    #####:   30:        offset += 31;
    %%%%%:   30-block  0
        -:   31:    }
        -:   32:  
        1:   33:    if (leap_year(y) && m > 2)
        1:   33-block  0
        1:   33-block  1
    #####:   34:        offset += 1;
    %%%%%:   34-block  0
        -:   35:  
        1:   36:    return offset;
        1:   36-block  0
        -:   37:}
        -:   38:  
        1:   39:void revoffsetDays(int offset, int y, int *d, int *m)
        -:   40:{
        1:   41:    int month[13] = { 0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 };
        -:   42:  
        1:   43:    if (leap_year(y))
        1:   43-block  0
        1:   44:        month[2] = 29;
        1:   44-block  0
        -:   45:  
        -:   46:    int i;
       1*:   47:    for (i = 1; i <= 12; i++)
        1:   47-block  0
        1:   47-block  1
        -:   48:    {
        1:   49:        if (offset <= month[i])
        1:   49-block  0
        1:   50:            break;
        1:   50-block  0
    #####:   51:        offset = offset - month[i];
    %%%%%:   51-block  0
        -:   52:    }
        -:   53:  
        1:   54:    *d = offset;
        1:   55:    *m = i;
        1:   56:}
        -:   57:  
        1:   58:void addDays(int d1, int m1, int y1, int x, Date *d)
        -:   59:{
        1:   60:    int offset1 = offsetDays(d1, m1, y1);
        1:   60-block  0
       1*:   61:    int remDays = leap_year(y1)?(366-offset1):(365-offset1);
        1:   61-block  0
    %%%%%:   61-block  1
        -:   62:  
        -:   63:    int y2, offset2;
        1:   64:    if (x <= remDays)
        1:   64-block  0
        -:   65:    {
        1:   66:        y2 = y1;
        1:   67:        offset2 = offset1 + x;
        1:   67-block  0
        -:   68:    }
        -:   69:  
        -:   70:    else
        -:   71:    {
    #####:   72:        x -= remDays;
    #####:   73:        y2 = y1 + 1;
    #####:   74:        int y2days = leap_year(y2)?366:365;
    %%%%%:   74-block  0
    %%%%%:   74-block  1
    %%%%%:   74-block  2
    #####:   75:        while (x >= y2days)
    %%%%%:   75-block  0
    %%%%%:   75-block  1
        -:   76:        {
    #####:   77:            x -= y2days;
    #####:   78:            y2++;
    #####:   79:            y2days = leap_year(y2)?366:365;
    %%%%%:   79-block  0
    %%%%%:   79-block  1
    %%%%%:   79-block  2
    %%%%%:   79-block  3
        -:   80:        }
    #####:   81:        offset2 = x;
    %%%%%:   81-block  0
        -:   82:    }
        -:   83:  
        -:   84:    int m2, d2;
        1:   85:    revoffsetDays(offset2, y2, &d2, &m2);
        1:   85-block  0
        1:   86:    d->dd=d2;
        1:   87:    d->mm=m2;
        1:   88:    d->yyyy=y2;
        1:   89:}
        -:   90:  
        1:   91:Date addDate(Date *d)
        -:   92:{
        1:   93:    addDays(d->dd,d->mm,d->yyyy,30,d);
        1:   93-block  0
        1:   94:}
